version: '3.9'

services:
  php:
    environment:
      # Set to 'debug,develop,coverage' when actively debugging, 'off' for normal use
      XDEBUG_MODE: "off"
      XDEBUG_CONFIG: client_host=host.docker.internal client_port=9003 idekey=PHPSTORM
      XDEBUG_SESSION: PHPSTORM
      PHP_IDE_CONFIG: serverName=vehicle-docker
    volumes:
      - ./backend:/var/www/html:cached
      - ./uploads:/var/www/html/uploads:rw
    user: "0:0"
    entrypoint: ["/usr/local/bin/docker-entrypoint.sh"]
    # Override resource limits for development (allow memory-intensive operations like report generation)
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 256M

  frontend:
    environment:
      - WATCHPACK_POLLING=true
      - REACT_APP_PASSWORD_POLICY=${REACT_APP_PASSWORD_POLICY}
      - REACT_APP_API_URL=${REACT_APP_API_URL}
    stdin_open: true
    tty: true
