{
  "key": "vehicle_report",
  "name": "{{t:reports.vehicleReport.name}}",
  "reportName": "{{vehicle.registrationNumber}} {{t:reports.vehicleReport.name}}",
  "title": "{{vehicle.make}} {{vehicle.model}} ({{vehicle.registrationNumber}})",
  "description": "Full vehicle report with costs, fuel records and economy calculations",
  "filename": "{{vehicle.make}}_{{vehicle.model}}_{{vehicle.registrationNumber}}_Report",
  "outputs": [
    { "mode": "screen" },
    { "mode": "file", "fileType": "xlsx" },
    { "mode": "file", "fileType": "pdf" }
  ],
  "periods": [ { "label": "{{t:reports.periods.allTime}}", "months": null } ],
  "defaultPeriodIndex": 0,
  "pageSetup": {
    "orientation": "portrait",
    "size": "A4"
  },
  "dataSources": {
    "vehicle": {
      "entity": "Vehicle",
      "filter": { "id": "{{vehicle_id}}" },
      "single": true
    },
    "parts": {
      "entity": "Part",
      "filter": { "vehicle": "{{vehicle_id}}" },
      "fields": { "date": "purchaseDate", "item": "description", "cost": "cost" }
    },
    "consumables": {
      "entity": "Consumable",
      "filter": { "vehicle": "{{vehicle_id}}" },
      "fields": { "date": "lastChanged", "item": "description", "cost": "cost" }
    },
    "serviceRecords": {
      "entity": "ServiceRecord",
      "filter": { "vehicle": "{{vehicle_id}}" },
      "fields": { "date": "serviceDate", "item": "serviceType", "cost": "laborCost" }
    },
    "motRecords": {
      "entity": "MotRecord",
      "filter": { "vehicle": "{{vehicle_id}}" }
    },
    "fuelRecords": {
      "entity": "FuelRecord",
      "filter": { "vehicle": "{{vehicle_id}}" },
      "sort": { "field": "date", "order": "asc" }
    },
    "costs": {
      "merge": ["parts", "consumables", "serviceRecords", "motRecords"],
      "sort": { "field": "date", "order": "asc" }
    }
  },
  "calculations": {
    "totalCosts": { "type": "sum", "source": "costs", "field": "cost" },
    "totalPartsCost": { "type": "sum", "source": "parts", "field": "cost" },
    "totalConsumablesCost": { "type": "sum", "source": "consumables", "field": "cost" },
    "totalServiceCost": { "type": "sum", "source": "serviceRecords", "field": "cost" },
    "totalMotCost": { "type": "sum", "source": "motRecords", "field": "cost" },
    "totalFuelCost": { "type": "sum", "source": "fuelRecords", "field": "cost" },
    "totalLitres": { "type": "sum", "source": "fuelRecords", "field": "litres" },
    "fuelFillCount": { "type": "count", "source": "fuelRecords" },
    "avgMpg": { "type": "avg", "source": "fuelRecords", "field": "mpg" }
  },
  "columnWidths": {
    "A": 2, "B": 12, "C": 55, "D": 12, "E": 2,
    "F": 12, "G": 12, "H": 10, "I": 12,
    "J": 10, "K": 8, "L": 10, "M": 10, "N": 2,
    "O": 18, "P": 25
  },
  "styles": {
    "headerStyle": {
      "font": { "bold": true, "size": 9 },
      "fill": { "color": "B2B2B2" },
      "border": "thin",
      "alignment": "center"
    },
    "subHeaderStyle": {
      "font": { "bold": true, "size": 9 },
      "fill": { "color": "D0D0D0" },
      "border": "thin"
    },
    "dataStyle": {
      "font": { "size": 9 },
      "border": "thin",
      "wrapText": true
    },
    "dataStyleRight": {
      "font": { "size": 9 },
      "border": "thin",
      "alignment": "right",
      "wrapText": true
    },
    "totalStyle": {
      "font": { "bold": true, "size": 9 },
      "fill": { "color": "B2B2B2" },
      "border": "thin"
    }
  },
  "layout": {
    "type": "sheet",
    "name": "{{vehicle.make}} {{vehicle.model}}",
    "sections": [
      {
        "type": "header",
        "row": 1,
        "cells": [
          { "col": "C", "value": "{{t:reports.vehicleReport.costs}}", "merge": "C1:D1", "style": "headerStyle" },
          { "col": "G", "value": "{{t:reports.vehicleReport.fuelCosts}}", "merge": "G1:I1", "style": "headerStyle" },
          { "col": "J", "value": "{{t:reports.vehicleReport.fuelEconomy}}", "merge": "J1:M1", "style": "headerStyle" },
          { "col": "O", "value": "{{t:common.vehicleDetails}}", "merge": "O1:P1", "style": "headerStyle" }
        ]
      },
      {
        "type": "columnHeaders",
        "row": 2,
        "cells": [
          { "col": "B", "value": "{{t:common.date}}", "style": "subHeaderStyle" },
          { "col": "C", "value": "{{t:reports.vehicleReport.item}}", "style": "subHeaderStyle" },
          { "col": "D", "value": "{{t:common.cost}}", "style": "subHeaderStyle" },
          { "col": "F", "value": "{{t:common.date}}", "style": "subHeaderStyle" },
          { "col": "G", "value": "{{distanceLabel}}", "style": "subHeaderStyle" },
          { "col": "H", "value": "{{t:reports.vehicleReport.noLitres}}", "style": "subHeaderStyle" },
          { "col": "I", "value": "{{t:common.cost}}", "style": "subHeaderStyle" },
          { "col": "J", "value": "No. {{distanceLabel}}", "style": "subHeaderStyle" },
          { "col": "K", "value": "{{economyLabel}}", "style": "subHeaderStyle" },
          { "col": "L", "value": "{{t:reports.vehicleReport.noLitres}}", "style": "subHeaderStyle" },
          { "col": "M", "value": "No. {{distanceLabel}}", "style": "subHeaderStyle" }
        ]
      },
      {
        "type": "dataGrid",
        "startRow": 3,
        "source": "costs",
        "columns": [
          { "col": "B", "field": "date", "style": "dataStyle" },
          { "col": "C", "field": "item", "style": "dataStyle" },
          { "col": "D", "field": "cost", "format": "currency", "style": "dataStyle" }
        ]
      },
      {
        "type": "dataGrid",
        "startRow": 3,
        "source": "fuelRecords",
        "columns": [
          { "col": "F", "field": "date", "style": "dataStyle" },
          { "col": "G", "field": "mileage", "format": "number", "style": "dataStyle" },
          { "col": "H", "field": "litres", "format": "number", "style": "dataStyle" },
          { "col": "I", "field": "cost", "format": "currency", "style": "dataStyle" },
          { "col": "J", "field": "miles", "format": "number", "style": "dataStyle" },
          { "col": "K", "field": "mpg", "format": "number", "style": "dataStyle" },
          { "col": "L", "field": "cumulativeLitres", "format": "number", "style": "dataStyle" },
          { "col": "M", "field": "cumulativeMiles", "format": "number", "style": "dataStyle" }
        ]
      },
      {
        "type": "vehicleDetails",
        "startRow": 3,
        "source": "vehicle",
        "labelCol": "O",
        "valueCol": "P",
        "style": "dataStyle",
        "valueStyle": "dataStyleRight",
        "fields": [
          { "label": "{{t:reports.vehicleReport.registration}}", "field": "registrationNumber" },
          { "label": "{{t:reports.vehicleReport.v5cReference}}", "field": "v5cReference" },
          { "label": "{{t:reports.vehicleReport.insuranceDue}}", "field": "insuranceDue" },
          { "label": "{{t:reports.vehicleReport.motDue}}", "field": "motDue" },
          { "label": "{{t:reports.vehicleReport.roadTaxDue}}", "field": "roadTaxDue" },
          { "label": "{{t:common.lastService}}", "field": "lastService" },
          { "label": "{{t:reports.vehicleReport.engineNo}}", "field": "engineNumber" },
          { "label": "{{t:reports.vehicleReport.frameNo}}", "field": "vin" },
          { "label": "{{t:reports.vehicleReport.frontTyreSize}}", "field": "frontTyreSize" },
          { "label": "{{t:reports.vehicleReport.frontPressure}}", "field": "frontTyrePressure" },
          { "label": "{{t:reports.vehicleReport.rearTyreSize}}", "field": "rearTyreSize" },
          { "label": "{{t:reports.vehicleReport.rearPressure}}", "field": "rearTyrePressure" },
          { "label": "{{t:reports.vehicleReport.oilCapacity}}", "field": "oilCapacity" },
          { "label": "{{t:reports.vehicleReport.oilType}}", "field": "oilType" },
          { "label": "{{t:common.fuelCapacity}}", "field": "fuelCapacity" }
        ]
      }
    ]
  },
  "pdfLayout": [
    {
      "type": "title",
      "text": "{{vehicle.make}} {{vehicle.model}} - {{t:reports.vehicleReport.name}}",
      "fontSize": 11
    },
    {
      "type": "table",
      "source": "vehicle",
      "columns": [
        { "field": "registrationNumber", "label": "{{t:reports.vehicleReport.registration}}", "width": 28 },
        { "field": "make", "label": "{{t:common.make}}", "width": 28 },
        { "field": "model", "label": "{{t:common.model}}", "width": 40 },
        { "field": "vin", "label": "{{t:common.vin}}", "width": 50 },
        { "field": "purchaseDate", "label": "{{t:reports.vehicleReport.purchased}}", "width": 22 },
        { "field": "purchaseCost", "label": "{{t:common.cost}}", "width": 22, "format": "currency" }
      ],
      "maxRows": 1
    },
    { "type": "spacer", "height": 5 },
    {
      "type": "table",
      "title": "{{t:reports.vehicleReport.costsTitle}}",
      "source": "costs",
      "columns": [
        { "field": "date", "label": "{{t:common.date}}", "width": 25 },
        { "field": "item", "label": "{{t:common.description}}", "width": 115 },
        { "field": "_source", "label": "{{t:common.type}}", "width": 25 },
        { "field": "cost", "label": "{{t:common.cost}}", "width": 25, "format": "currency" }
      ],
      "showTotal": true,
      "totalLabel": "{{t:common.total}}:"
    },
    { "type": "spacer", "height": 5 },
    {
      "type": "table",
      "title": "{{t:common.fuelRecords}}",
      "source": "fuelRecords",
      "columns": [
        { "field": "date", "label": "{{t:common.date}}", "width": 28 },
        { "field": "mileage", "label": "{{t:common.mileage}}", "width": 35 },
        { "field": "litres", "label": "{{t:common.litres}}", "width": 28 },
        { "field": "cost", "label": "{{t:common.cost}}", "width": 35, "format": "currency" },
        { "field": "miles", "label": "{{t:reports.vehicleReport.miles}}", "width": 32 },
        { "field": "mpg", "label": "{{t:reports.vehicleReport.mpg}}", "width": 32 }
      ],
      "showTotal": true,
      "totalLabel": "{{t:common.total}}:"
    },
    { "type": "spacer", "height": 5 },
    {
      "type": "summary",
      "title": "{{t:reports.vehicleReport.summary}}",
      "items": [
        { "label": "{{t:common.totalPartsCost}}:", "value": "{{totalPartsCost}}", "format": "currency" },
        { "label": "{{t:reports.vehicleReport.totalConsumables}}:", "value": "{{totalConsumablesCost}}", "format": "currency" },
        { "label": "{{t:reports.vehicleReport.totalService}}:", "value": "{{totalServiceCost}}", "format": "currency" },
        { "label": "{{t:reports.vehicleReport.totalMot}}:", "value": "{{totalMotCost}}", "format": "currency" },
        { "label": "{{t:reports.vehicleReport.totalCosts}}:", "value": "{{totalCosts}}", "format": "currency", "bold": true },
        { "label": "", "value": "" },
        { "label": "{{t:reports.vehicleReport.totalFuelCost}}:", "value": "{{totalFuelCost}}", "format": "currency" },
        { "label": "{{t:reports.vehicleReport.totalLitres}}:", "value": "{{totalLitres}}", "format": "number" },
        { "label": "{{t:reports.vehicleReport.averageMpg}}:", "value": "{{avgMpg}}", "format": "number" }
      ]
    }
  ]
}
